<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Picture Diary</title>
    <meta name="description" content="テキストから日記を整形し、画像と音楽のプロンプトを生成するミニWebアプリ。" />
    <link rel="canonical" href="https://attrip.github.io/picture_diary/" />

    <!-- App Icons -->
    <link rel="icon" type="image/svg+xml" href="./assets/icon.svg" />
    <link rel="shortcut icon" type="image/svg+xml" href="./favicon.svg" />
    <link rel="mask-icon" href="./assets/mask-icon.svg" color="#6aa4ff" />
    <!-- Optional PNG touch icon: place apple-touch-icon.png under assets/ -->
    <link rel="apple-touch-icon" href="./assets/apple-touch-icon.png" />
    <link rel="manifest" href="./site.webmanifest" />
    <meta name="theme-color" content="#0f1216" />
    <meta name="application-name" content="Picture Diary" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

    <!-- Open Graph / Twitter -->
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Picture Diary" />
    <meta property="og:description" content="テキストから日記整形＋画像/音楽プロンプトを生成。" />
    <meta property="og:url" content="https://attrip.github.io/picture_diary/" />
    <!-- Use repo OG image as fallback until a local one is provided -->
    <meta property="og:image" content="https://opengraph.githubassets.com/1/attrip/picture_diary" />
    <meta name="twitter:card" content="summary_large_image" />

    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <header class="container">
      <div style="display: flex; justify-content: space-between; align-items: flex-start;">
        <div>
          <h1>Picture Diary</h1>
          <p class="sub">テキストを日記に整形し、絵を作るためのプロンプトを生成します。</p>
        </div>
        <button id="theme-toggle" type="button" title="テーマを切り替え" style="font-size: 24px; background: transparent; border: none; cursor: pointer; padding: 0; margin-top: 12px; color: var(--text);">☀️</button>
      </div>
      <nav class="steps" aria-label="作成ステップ">
        <ol>
          <li id="step-input" aria-current="step">1. 入力</li>
          <li id="step-format">2. 整形</li>
          <li id="step-prompt">3. プロンプト</li>
        </ol>
      </nav>
    </header>

    <main class="container grid">
      <section class="card">
        <h2>チャットで作成</h2>
        <div class="row">
          <div class="field">
            <label for="chatMode">作成タイプ</label>
            <select id="chatMode">
              <option value="essay">エッセイ</option>
              <option value="diary">日記</option>
              <option value="rap">ラップ</option>
              <option value="memo" selected>メモ</option>
            </select>
          </div>
        </div>
        <div id="chat" class="chat">
          <div id="chatMessages" class="messages"></div>
          <div class="chat-controls">
            <textarea id="chatInput" rows="2" placeholder="ここに返信を入力（Enterで改行、Ctrl/⌘+Enterで送信）"></textarea>
          </div>
          <nav class="actions chat-nav" aria-label="チャット操作">
            <button id="chatRestart">やり直す</button>
            <button id="chatSend" class="primary">送信</button>
          </nav>
          <div class="actions" style="margin-top: 4px; justify-content: flex-end;">
            <label style="display:flex; gap:8px; align-items:center; cursor:pointer; font-size: 0.9em;">
              <input id="chatEnterToSend" type="checkbox" checked />
              <span>Enterで送信</span>
            </label>
          </div>
          <div class="ideas-row">
            <small class="hint">アイデアに迷ったら：下の候補をクリック</small>
            <div class="chips" id="chatIdeas"></div>
            <div class="actions" style="margin:4px 0 0;">
              <button id="chatIdeasRefresh" type="button">アイデアを更新</button>
            </div>
          </div>
          <div class="actions">
            <button id="chatSkip">スキップ</button>
            <button id="chatUndo">取り消し</button>
            <button id="chatFinalize" class="primary">まとめて生成</button>
          </div>
          <p class="hint">質問に答えると、下の入力欄に自動で文章をまとめます。</p>
        </div>
      </section>

      <section class="card">
        <h2>入力</h2>
        <label for="rawText" class="label">今日の出来事・感想を自由に書いてください</label>
        <textarea id="rawText" placeholder="例：朝は小雨。駅まで走って遅刻しそうになったけど、友達と会えて元気が出た。夕方は公園で彼岸花がきれいだった。" rows="8"></textarea>

        <div class="row">
          <div class="field">
            <label for="style">スタイル</label>
            <select id="style">
              <option value="cinematic_lighting" selected>1. シネマティック・ライティング</option>
              <option value="artist_fusion">2. アーティストスタイル・フュージョン</option>
              <option value="nostalgic_film">3. ノスタルジック・フィルム</option>
              <option value="ukiyoe_pop">4. 浮世絵ポップ</option>
              <option value="retro_future_80s">5. レトロフューチャー'80s</option>
              <option value="minimal_line_art">6. ミニマル・ラインアート</option>
              <option value="watercolor_ink">7. 水彩画 ＆ インク</option>
              <option value="impasto_concept">8. 厚塗り・コンセプトアート風</option>
              <option value="double_exposure">9. ダブルエクスポージャー</option>
              <option value="abstract_expressionism">10. 抽象表現主義アート</option>
            </select>
          </div>
          <div class="field">
            <label for="mood">雰囲気</label>
            <select id="mood">
              <option value="warm">あたたかい / warm</option>
              <option value="nostalgic">ノスタルジック / nostalgic</option>
              <option value="dreamy">夢のよう / dreamy</option>
              <option value="calm" selected>穏やか / calm</option>
              <option value="energetic">元気 / energetic</option>
              <option value="melancholy">もの静か / melancholy</option>
              <option value="cozy">居心地よい / cozy</option>
              <option value="rainy">雨の情緒 / rainy</option>
              <option value="night">夜景 / night</option>
              <option value="sunny">晴れやか / sunny</option>
            </select>
          </div>
          <div class="field">
            <label for="diaryStyle">整形スタイル</label>
            <select id="diaryStyle">
              <option value="prose" selected>通常（文章）</option>
              <option value="essay">エッセイ風</option>
              <option value="rap">ラップ風</option>
            </select>
            <div class="chips" id="diaryStyleChips">
              <button type="button" class="chip" data-diary-style="prose">文章</button>
              <button type="button" class="chip" data-diary-style="essay">エッセイ</button>
              <button type="button" class="chip" data-diary-style="rap">ラップ</button>
            </div>
          </div>
        </div>

        <details id="detailsOpts">
          <summary aria-controls="detailsOpts">詳細設定</summary>
          <div class="row" aria-label="詳細設定の選択肢">
            <div class="field">
              <label for="aspect">アスペクト比</label>
              <select id="aspect">
                <option value="1:1">1:1</option>
                <option value="3:2">3:2</option>
                <option value="4:3">4:3</option>
                <option value="16:9">16:9</option>
              </select>
            </div>
            <div class="field">
              <label for="detail">ディテール</label>
              <select id="detail">
                <option value="balanced">標準</option>
                <option value="simple">簡素</option>
                <option value="high">高精細</option>
              </select>
            </div>
            <div class="field" style="min-width: 260px; align-self: end;">
              <label for="titleInImage">画像内の文字</label>
              <label style="display:flex; gap:8px; align-items:center;">
                <input id="titleInImage" type="checkbox" />
                <span>基本は文字を描かない（必要なら小さなタイトルのみ）</span>
              </label>
            </div>
          </div>
        </details>

        <button id="generateBtn" class="primary">日記とプロンプトを生成</button>
      </section>

      <section class="card">
        <h2>日記と画像生成プロンプト</h2>
        <div class="chips" id="diaryStyleChips2" aria-label="整形スタイル">
          <button type="button" class="chip" data-diary-style="prose">文章</button>
          <button type="button" class="chip" data-diary-style="essay">エッセイ</button>
          <button type="button" class="chip" data-diary-style="rap">ラップ</button>
        </div>

        <div class="split-grid">
          <div>
            <h3 style="margin:6px 0;">日記（自動整形）</h3>
            <textarea id="diaryOut" rows="10" readonly></textarea>
            <div class="actions">
              <button data-copy="#diaryOut">コピー</button>
              <button data-open="chatgpt" data-source="#diaryOut">ChatGPTで開く</button>
              <button data-open="gemini" data-source="#diaryOut">Geminiで開く</button>
            </div>
          </div>
          <div>
            <h3 style="margin:6px 0;">画像生成プロンプト</h3>
            <textarea id="promptOut" rows="12" readonly></textarea>
            <div class="actions">
              <button data-copy="#promptOut">コピー</button>
              <button data-open="chatgpt">ChatGPTで開く</button>
              <button data-open="gemini">Geminiで開く</button>
            </div>
            <p class="hint">「ChatGPTで開く」「Geminiで開く」を押すと、プロンプトをコピーして新しいタブを開きます。貼り付けて送信してください。</p>
          </div>
        </div>
      </section>

      <section class="card wide">
        <details>
          <summary><h2>音楽プロンプト（Suno風）</h2></summary>
          <div id="musicCard" style="margin-top: 1rem;">
            <h3 style="margin:8px 0 6px;">クイックプリセット（細かい設定不要）</h3>
            <div class="chips" id="musicQuickPresets">
              <button type="button" class="chip" data-preset="lofi_night">Lo-fi 夜散歩</button>
              <button type="button" class="chip" data-preset="city_afterglow">City Pop 余韻</button>
              <button type="button" class="chip" data-preset="trap_rain">Trap 雨上がり</button>
              <button type="button" class="chip" data-preset="acoustic_morning">Acoustic 朝</button>
              <button type="button" class="chip" data-preset="jazz_cafe">Jazz カフェ</button>
              <button type="button" class="chip" data-preset="bossa_sunset">Bossa 夕暮れ</button>
              <button type="button" class="chip" data-preset="jpop_ballad">J-POP バラード</button>
              <button type="button" class="chip" data-preset="indie_pop">Indie Pop 週末</button>
              <button type="button" class="chip" data-preset="boom_bap_jp">Boom Bap 帰り道</button>
              <button type="button" class="chip" data-preset="lofi_rap">Lo-fi Rap 雨</button>
              <button type="button" class="chip" data-preset="chill_rap">Chill Rap 低気圧</button>
              <button type="button" class="chip" data-preset="emo_rock">Emo Rock</button>
              <button type="button" class="chip" data-preset="punk_garage">Punk / Garage</button>
              <button type="button" class="chip" data-preset="edm_house">EDM / House</button>
              <button type="button" class="chip" data-preset="ambient_afterglow">Ambient Afterglow</button>
              <button type="button" class="chip" data-preset="dub_night">Dub 夜歩き</button>
              <button type="button" class="chip ghost" data-preset="random">おまかせ</button>
              <button type="button" class="chip ghost" data-preset="clear">選択しない（既定）</button>
            </div>
            <small id="musicPresetLabel" class="hint"></small>
            <div class="row">
              <div class="field" id="musicThemeGroup" style="min-width:280px">
                <label for="musicTheme">テーマ（短く・名詞で）</label>
                <div class="input-row">
                  <input id="musicTheme" type="text" placeholder="例：雨上がり / 都会の夜 / 帰り道" />
                  <button id="musicThemeClear" type="button" aria-label="テーマをクリア">クリア</button>
                </div>
                <div class="chips" id="musicThemeChips" aria-label="テーマ候補">
                  <button type="button" class="chip ghost" data-theme="日常">日常</button>
                  <button type="button" class="chip ghost" data-theme="都会">都会</button>
                  <button type="button" class="chip ghost" data-theme="帰り道">帰り道</button>
                  <button type="button" class="chip ghost" data-theme="夜散歩">夜散歩</button>
                  <button type="button" class="chip ghost" data-theme="雨上がり">雨上がり</button>
                  <button type="button" class="chip ghost" data-theme="孤独">孤独</button>
                  <button type="button" class="chip ghost" data-theme="余韻">余韻</button>
                </div>
                <small id="musicThemePreview" class="hint">English keywords: everyday life / city / afterglow</small>
                <small class="hint">日本語入力OK（プロンプトは英語で出力）</small>
              </div>
              <div class="field">
                <label for="musicGenre">ジャンル</label>
                <select id="musicGenre">
                  <option value="jpop">J-POP</option>
                  <option value="citypop" selected>City Pop</option>
                  <option value="lofi">Lo-fi Hip Hop</option>
                  <option value="trap">Trap / Emo Rap</option>
                  <option value="rb">R&B</option>
                  <option value="rock">Rock / Indie</option>
                  <option value="acoustic">Acoustic / Folk</option>
                  <option value="edm">EDM / House</option>
                  <option value="futurebass">Future Bass</option>
                  <option value="jazz">Jazz</option>
                  <option value="bossa">Bossa Nova</option>
                </select>
              </div>
              <div class="field">
                <label for="musicMood">雰囲気</label>
                <select id="musicMood">
                  <option value="warm">あたたかい</option>
                  <option value="nostalgic" selected>ノスタルジック</option>
                  <option value="dreamy">夢のよう</option>
                  <option value="energetic">元気</option>
                  <option value="melancholy">もの静か</option>
                  <option value="cozy">居心地よい</option>
                  <option value="rainy">雨の情緒</option>
                  <option value="night">夜</option>
                  <option value="sunny">晴れやか</option>
                </select>
              </div>
              <div class="field">
                <label for="musicVocal">ボーカル</label>
                <select id="musicVocal">
                  <option value="sing" selected>歌</option>
                  <option value="rap">ラップ</option>
                  <option value="both">ミックス（歌+ラップ）</option>
                </select>
              </div>
              <div class="field">
                <label for="musicLang">言語</label>
                <select id="musicLang">
                  <option value="ja" selected>日本語</option>
                  <option value="en">英語</option>
                  <option value="mix">ミックス</option>
                </select>
              </div>
              <div class="field">
                <label for="musicTone">歌詞のトーン</label>
                <select id="musicTone">
                  <option value="introspective" selected>内省的</option>
                  <option value="poetic">詩的</option>
                  <option value="colloquial">口語的</option>
                  <option value="punchy">力強い</option>
                  <option value="humorous">ユーモア</option>
                  <option value="melancholic">物悲しい</option>
                  <option value="romantic">ロマンチック</option>
                  <option value="empowering">前向き</option>
                  <option value="storytelling">物語調</option>
                  <option value="minimal">ミニマル</option>
                </select>
              </div>
              <div class="field">
                <label for="musicTempo">テンポ</label>
                <select id="musicTempo">
                  <option value="slow">ゆっくり（70-90）</option>
                  <option value="mid" selected>ふつう（90-110）</option>
                  <option value="fast">はやい（120-150）</option>
                </select>
              </div>
            </div>
            <div class="chips" id="musicGenreChips">
              <button data-genre="citypop" class="chip">City Pop</button>
              <button data-genre="lofi" class="chip">Lo-fi</button>
              <button data-genre="trap" class="chip">Trap</button>
              <button data-genre="rb" class="chip">R&B</button>
              <button data-genre="rock" class="chip">Rock</button>
              <button data-genre="acoustic" class="chip">Acoustic</button>
              <button data-genre="edm" class="chip">EDM</button>
              <button data-genre="jazz" class="chip">Jazz</button>
              <button data-genre="bossa" class="chip">Bossa</button>
            </div>
            <h3 style="margin:8px 0 4px;">カスタムプリセット</h3>
            <div class="chips" id="musicCustomChips">
              <button data-genre="rap" class="chip">Rap</button>
              <button data-genre="reggae" class="chip">Reggae</button>
              <button data-genre="dub" class="chip">Dub</button>
              <button data-genre="jungle" class="chip">Jungle</button>
            </div>
            <details id="addPresetDetails" style="margin:8px 0 12px;">
              <summary>＋ プリセットを追加</summary>
              <div class="row">
                <div class="field"><label for="presetKey">キー(英字)</label><input id="presetKey" type="text" placeholder="例: hyperpop" /></div>
                <div class="field"><label for="presetName">表示名</label><input id="presetName" type="text" placeholder="例: Hyperpop" /></div>
                <div class="field"><label for="presetInstr">楽器/質感</label><input id="presetInstr" type="text" placeholder="例: detuned saws, glossy leads, clipped drums" /></div>
                <div class="field"><label for="presetBpm">BPM目安</label><input id="presetBpm" type="text" placeholder="例: 150-180" /></div>
              </div>
              <button id="presetAddBtn" type="button">追加</button>
              <p class="hint">キーは英字で。スペースは自動でハイフンに変換（例: "future bass" → "future-bass"）。</p>
            </details>
            <button id="musicGenerate" class="primary">音楽プロンプトを生成</button>
            <p class="hint">出力は英語のみ。言語設定は歌詞アイデアの言語に適用されます。</p>
            <h3 style="margin:12px 0 6px;">音楽プロンプト</h3>
            <textarea id="musicOut" rows="8" readonly></textarea>
            <div class="actions">
              <button data-copy="#musicOut">コピー</button>
            </div>
            <h3 style="margin:12px 0 6px;">歌・ラップのアイデア</h3>
            <textarea id="lyricOut" rows="6" readonly></textarea>
            <div class="actions">
              <button data-copy="#lyricOut">コピー</button>
            </div>
          </div>
        </details>
      </section>
    </main>

    <footer class="container footer">
      <small>© Picture Diary</small>
    </footer>

    <section class="container card" style="margin-top:12px;">
      <h2>履歴</h2>
      <p class="hint">この端末のブラウザに自動保存されます（最大500件）。</p>
      <div class="actions">
        <button id="historyExport" type="button">エクスポート（JSON）</button>
        <button id="historyClear" type="button">履歴を消去</button>
      </div>
      <small id="historyCount" class="hint"></small>
      <ul id="historyList" class="history-list"></ul>
    </section>

    <script src="lib/prompt.js"></script>
    <script src="lib/music.js"></script>
    <script src="lib/log.js"></script>
    <script src="app/main.js"></script>
  </body>
  <div id="toast" role="status" aria-live="polite" aria-atomic="true"></div>
  </html>
