<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Picture Diary</title>
    <meta name="description" content="テキストから日記を整形し、画像と音楽のプロンプトを生成するミニWebアプリ。" />
    <link rel="canonical" href="https://attrip.github.io/picture_diary/" />

    <!-- App Icons -->
    <link rel="icon" type="image/svg+xml" href="./assets/icon.svg" />
    <link rel="shortcut icon" type="image/svg+xml" href="./favicon.svg" />
    <link rel="mask-icon" href="./assets/mask-icon.svg" color="#6aa4ff" />
    <!-- Optional PNG touch icon: place apple-touch-icon.png under assets/ -->
    <link rel="apple-touch-icon" href="./assets/apple-touch-icon.png" />
    <link rel="manifest" href="./site.webmanifest" />
    <meta name="theme-color" content="#0f1216" />
    <meta name="application-name" content="Picture Diary" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

    <!-- Open Graph / Twitter -->
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Picture Diary" />
    <meta property="og:description" content="テキストから日記整形＋画像/音楽プロンプトを生成。" />
    <meta property="og:url" content="https://attrip.github.io/picture_diary/" />
    <!-- Use repo OG image as fallback until a local one is provided -->
    <meta property="og:image" content="https://opengraph.githubassets.com/1/attrip/picture_diary" />
    <meta name="twitter:card" content="summary_large_image" />

    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <header class="container">
      <div style="display: flex; justify-content: space-between; align-items: flex-start;">
        <div>
          <h1>Picture Diary</h1>
          <p class="sub">テキストを日記に整形し、絵を作るためのプロンプトを生成します。</p>
        </div>
        <button id="theme-toggle" type="button" title="テーマを切り替え" style="font-size: 24px; background: transparent; border: none; cursor: pointer; padding: 0; margin-top: 12px; color: var(--text);">☀️</button>
      </div>
      <nav class="steps" aria-label="作成ステップ">
        <ol>
          <li id="step-input" aria-current="step">1. 入力</li>
          <li id="step-format">2. 整形</li>
          <li id="step-prompt">3. プロンプト</li>
        </ol>
      </nav>
    </header>

    <main class="container grid">
      <section class="card">
        <h2>チャットで作成</h2>
        <div class="row">
          <div class="field">
            <label for="chatMode">作成タイプ</label>
            <select id="chatMode">
              <option value="essay">エッセイ</option>
              <option value="diary">日記</option>
              <option value="rap">ラップ</option>
              <option value="memo" selected>メモ</option>
            </select>
          </div>
        </div>
        <div id="chat" class="chat">
          <div id="chatMessages" class="messages"></div>
          <div class="chat-controls">
            <textarea id="chatInput" rows="2" placeholder="ここに返信を入力（Enterで改行、Ctrl/⌘+Enterで送信）"></textarea>
          </div>
          <nav class="actions chat-nav" aria-label="チャット操作">
            <button id="chatRestart">やり直す</button>
            <button id="chatSend" class="primary">送信</button>
          </nav>
          <div class="actions" style="margin-top: 4px; justify-content: flex-end;">
            <label style="display:flex; gap:8px; align-items:center; cursor:pointer; font-size: 0.9em;">
              <input id="chatEnterToSend" type="checkbox" checked />
              <span>Enterで送信</span>
            </label>
          </div>
          <div class="ideas-row">
            <small class="hint">アイデアに迷ったら：下の候補をクリック</small>
            <div class="chips" id="chatIdeas"></div>
            <div class="actions" style="margin:4px 0 0;">
              <button id="chatIdeasRefresh" type="button">アイデアを更新</button>
            </div>
          </div>
          <div class="actions">
            <button id="chatSkip">スキップ</button>
            <button id="chatUndo">取り消し</button>
            <button id="chatFinalize" class="primary">まとめて生成</button>
          </div>
          <p class="hint">質問に答えると、下の入力欄に自動で文章をまとめます。</p>
        </div>
      </section>

      <section class="card">
        <h2>入力</h2>
        <label for="rawText" class="label">今日の出来事・感想を自由に書いてください</label>
        <textarea id="rawText" placeholder="例：朝は小雨。駅まで走って遅刻しそうになったけど、友達と会えて元気が出た。夕方は公園で彼岸花がきれいだった。" rows="8"></textarea>

        <div class="row">
          <div class="field">
            <label for="style">スタイル</label>
            <select id="style">
              <option value="cinematic_lighting" selected>1. シネマティック・ライティング</option>
              <option value="artist_fusion">2. アーティストスタイル・フュージョン</option>
              <option value="nostalgic_film">3. ノスタルジック・フィルム</option>
              <option value="ukiyoe_pop">4. 浮世絵ポップ</option>
              <option value="retro_future_80s">5. レトロフューチャー'80s</option>
              <option value="minimal_line_art">6. ミニマル・ラインアート</option>
              <option value="watercolor_ink">7. 水彩画 ＆ インク</option>
              <option value="impasto_concept">8. 厚塗り・コンセプトアート風</option>
              <option value="double_exposure">9. ダブルエクスポージャー</option>
              <option value="abstract_expressionism">10. 抽象表現主義アート</option>
              <option value="retro_anime_showa">11. レトロアニメ風／昭和アニメ風カラーリング</option>
            </select>
          </div>
          <div class="field">
            <label for="mood">雰囲気</label>
            <select id="mood">
              <option value="warm">あたたかい / warm</option>
              <option value="nostalgic">ノスタルジック / nostalgic</option>
              <option value="dreamy">夢のよう / dreamy</option>
              <option value="calm" selected>穏やか / calm</option>
              <option value="energetic">元気 / energetic</option>
              <option value="melancholy">もの静か / melancholy</option>
              <option value="cozy">居心地よい / cozy</option>
              <option value="rainy">雨の情緒 / rainy</option>
              <option value="night">夜景 / night</option>
              <option value="sunny">晴れやか / sunny</option>
            </select>
          </div>
          <div class="field">
            <label for="diaryStyle">整形スタイル</label>
            <select id="diaryStyle">
              <option value="prose" selected>通常（文章）</option>
              <option value="essay">エッセイ風</option>
              <option value="rap">ラップ風</option>
            </select>
            <div class="chips" id="diaryStyleChips">
              <button type="button" class="chip" data-diary-style="prose">文章</button>
              <button type="button" class="chip" data-diary-style="essay">エッセイ</button>
              <button type="button" class="chip" data-diary-style="rap">ラップ</button>
            </div>
          </div>
        </div>

        <details id="detailsOpts">
          <summary aria-controls="detailsOpts">詳細設定</summary>
          <div class="row" aria-label="詳細設定の選択肢">
            <div class="field">
              <label for="aspect">アスペクト比</label>
              <select id="aspect">
                <option value="1:1">1:1</option>
                <option value="3:2">3:2</option>
                <option value="4:3">4:3</option>
                <option value="16:9">16:9</option>
              </select>
            </div>
            <div class="field">
              <label for="detail">ディテール</label>
              <select id="detail">
                <option value="balanced">標準</option>
                <option value="simple">簡素</option>
                <option value="high">高精細</option>
              </select>
            </div>
            <div class="field" style="min-width: 260px; align-self: end;">
              <label for="titleInImage">画像内の文字</label>
              <label style="display:flex; gap:8px; align-items:center;">
                <input id="titleInImage" type="checkbox" />
                <span>基本は文字を描かない（必要なら小さなタイトルのみ）</span>
              </label>
            </div>
          </div>
        </details>

        <div class="actions" style="justify-content: space-between; align-items: center; gap: 12px; flex-wrap: wrap;">
          <button id="generateBtn" class="primary">全部まとめて生成（日記＋画像＋音楽）</button>
          <label style="display:flex; gap:8px; align-items:center; font-size: 0.95em;">
            <input id="autoGenerate" type="checkbox" />
            <span>自動生成（入力に応じて自動更新）</span>
          </label>
        </div>
      </section>

      <section class="card">
        <h2>日記と画像生成プロンプト</h2>
        <div class="chips" id="diaryStyleChips2" aria-label="整形スタイル">
          <button type="button" class="chip" data-diary-style="prose">文章</button>
          <button type="button" class="chip" data-diary-style="essay">エッセイ</button>
          <button type="button" class="chip" data-diary-style="rap">ラップ</button>
        </div>

        <div class="split-grid">
          <div>
            <h3 style="margin:6px 0;">日記（自動整形）</h3>
            <textarea id="diaryOut" rows="10" readonly></textarea>
            <div class="actions">
              <button data-copy="#diaryOut">コピー</button>
              <button data-open="chatgpt" data-source="#diaryOut">ChatGPTで開く</button>
              <button data-open="gemini" data-source="#diaryOut">Geminiで開く</button>
            </div>
          </div>
          <div>
            <h3 style="margin:6px 0;">画像生成プロンプト</h3>
            <textarea id="promptOut" rows="12" readonly></textarea>
            <div class="actions">
              <button data-copy="#promptOut">コピー</button>
              <button data-open="chatgpt">ChatGPTで開く</button>
              <button data-open="gemini">Geminiで開く</button>
            </div>
            <p class="hint">「ChatGPTで開く」「Geminiで開く」を押すと、プロンプトをコピーして新しいタブを開きます。貼り付けて送信してください。</p>
          </div>
        </div>
      </section>

      <section class="card wide">
        <details>
          <summary><h2>音楽プロンプト（Suno風）</h2></summary>
          <div id="musicCard" style="margin-top: 1rem;">
            <h3 style="margin:12px 0 6px;">自由入力（説明から自動変換）</h3>
            <label for="musicDesc" class="label">音楽の説明（日本語/英語OK）</label>
            <textarea id="musicDesc" rows="3" placeholder="例：高揚感のあるEDM。ブリッジでコール＆レスポンス。ボーカルなし。夜のドライブ。"></textarea>
            
            <button id="musicGenerate" class="primary">音楽プロンプトを生成</button>
            
            <h3 style="margin:12px 0 6px;">音楽プロンプト</h3>
            <textarea id="musicOut" rows="8" readonly></textarea>
            <div class="actions">
              <button data-copy="#musicOut">コピー</button>
              <button data-open="chatgpt" data-source="#musicOut">ChatGPTで開く</button>
              <button data-open="gemini" data-source="#musicOut">Geminiで開く</button>
            </div>
          </div>
        </details>
      </section>

      <section class="card wide">
        <h2>まとめプロンプト（全部依頼用）</h2>
        <p class="hint">下記をChatGPT/Geminiに貼ると、まず「提案（実行プラン含む）」を出し、あなたが「はい」と返すと画像/音声の生成に進む流れになります（モデル側でツールが使える場合）。</p>
        <textarea id="masterPromptOut" rows="12" readonly></textarea>
        <div class="actions">
          <button data-copy="#masterPromptOut">コピー</button>
          <button data-open="chatgpt" data-source="#masterPromptOut">ChatGPTで開く</button>
          <button data-open="gemini" data-source="#masterPromptOut">Geminiで開く</button>
        </div>
      </section>
    </main>

    <footer class="container footer">
      <small>© Picture Diary</small>
    </footer>

    <section class="container card" style="margin-top:12px;">
      <h2>履歴</h2>
      <p class="hint">この端末のブラウザに自動保存されます（最大500件）。</p>
      <div class="actions">
        <button id="historyExport" type="button">エクスポート（JSON）</button>
        <button id="historyClear" type="button">履歴を消去</button>
      </div>
      <small id="historyCount" class="hint"></small>
      <ul id="historyList" class="history-list"></ul>
    </section>

    <script src="lib/prompt.js"></script>
    <script src="lib/log.js"></script>
    <script src="lib/rap.js"></script>
    <script src="lib/master.js"></script>
    <script src="app/main.js"></script>
    <div id="toast" role="status" aria-live="polite" aria-atomic="true"></div>
  </body>
  </html>
